(()=>{"use strict";var t={895:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Building=void 0,i.Building=class{constructor(t){if(4!==t.length)throw Error("Invalid building vertices");this.vertices=t;const i=this.vertices.map((t=>t.x)),e=this.vertices.map((t=>t.y));this.position={x:Math.min(...i),y:Math.min(...e)},this.width=Math.max(...i)-this.position.x+1,this.height=Math.max(...e)-this.position.y+1}each(t){for(let i=0;i<this.width;i++)for(let e=0;e<this.height;e++)t({x:this.position.x+i,y:this.position.y+e})}}},863:function(t,i,e){var n=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))((function(s,r){function o(t){try{a(n.next(t))}catch(t){r(t)}}function h(t){try{a(n.throw(t))}catch(t){r(t)}}function a(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,h)}a((n=n.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.City=void 0;const s=e(82),r=e(792),o=e(309),h=e(679),a=e(895);i.City=class{constructor({width:t,height:i}){this.seed=null,this.matrix=[],this.nodes=[],this.gauge=1,this.params={},this.width=t,this.height=i}getMatrix(){return this.matrix}getSeed(){return this.seed}getAllBuildings(){return this.getAllPaths().map((t=>t.getBuildings())).flat()}getBuildingAt(t){const i=this.getAt(t);return i instanceof a.Building?i:null}getAllNodes(){return this.nodes}getNodeAt(t){const i=this.getAt(t);return i instanceof r.Node?i:null}getAllPaths(){return this.nodes.map((t=>t.getOutputPaths())).flat()}getPathAt(t){const i=this.getAt(t);return i instanceof s.Path?i:null}getAt(t){var i,e;return null===(e=null===(i=this.matrix)||void 0===i?void 0:i[t.y])||void 0===e?void 0:e[t.x]}markAt(t,i){this.matrix[t.y][t.x]=i}isEmptyAt(t){return null===this.getAt(t)}generate(t={}){return n(this,void 0,void 0,(function*(){this.reset(),this.params=Object.assign({mode:o.CityGenerationMode.RUNTIME,seed:[],startPosition:{x:Math.round(this.width/2),y:Math.round(this.height/2)},startDirections:[0,90,180,270],streetMinLength:10,buildingMinSize:3,buildingMaxSize:6,buildingMinSpace:1,buildingMaxSpace:3,probabilityIntersection:.1,probabilityTurn:.05,probabilityStreetEnd:.001},t),this.params.mode===o.CityGenerationMode.SEED&&(this.seed=0===this.params.seed.length?(0,h.generateSeed)():this.params.seed);const i=this.addNode(this.params.startPosition);this.markAt(this.params.startPosition,i),this.params.startDirections.forEach((t=>{i.addOutputPath(t)})),this.generatePaths(),this.generateBuildings()}))}reset(){for(let t=0;t<this.height;t++){this.matrix[t]=[];for(let i=0;i<this.width;i++)this.matrix[t][i]=null}this.seed=null,this.gauge=1,this.nodes=[]}generatePaths(){const t=()=>{const i=this.getAllPaths();for(let t=0,e=i.length;t<e;t++)this.processingPath(i[t]);i.every((t=>t.isCompleted()))||t()};t()}processingPath(t){if(t.isCompleted())return;const i=t.getNextCursor();if(void 0===this.getAt(i)||this.variability(this.params.probabilityStreetEnd))return void this.closePath(t);const e=this.getCross(t);if(null==e?void 0:e.tile){let i=null;return e.tile instanceof r.Node?i=e.tile:e.tile instanceof s.Path&&(i=this.splitPath(e.tile,e.position)),void(i&&t.setNodeEnd(i))}t.setCursor(i),this.markAt(t.getCursor(),t);const n=this.params.streetMinLength;t.getLength()>n&&!this.getCross(t,n)&&(this.variability(this.params.probabilityIntersection)?this.forkPath(t):this.variability(this.params.probabilityTurn)&&this.turnPath(t))}generateBuildings(){this.getAllPaths().forEach((t=>{const i=(0,h.getShift)(t.direction),e=t.getNodeBeg().position.x+i.x,n=t.getNodeBeg().position.y+i.y;(0,h.turnDirection)(t.direction).forEach((i=>{let s=0;for(;t.getLength()>s;){const r=(0,h.getShift)(t.direction,s),o=(0,h.getShift)(i),a={x:e+r.x+o.x,y:n+r.y+o.y},u=[(0,h.randomRange)(this.params.buildingMinSize,this.params.buildingMaxSize),(0,h.randomRange)(this.params.buildingMinSize,this.params.buildingMaxSize)];if(s+u[0]>t.getLength())break;this.processingBuilding(t,a,u,[t.direction,i]);const d=(0,h.randomRange)(this.params.buildingMinSpace,this.params.buildingMaxSpace);s+=u[0]+d}}))}))}processingBuilding(t,i,e,n){const s=[],r=[];for(let t=0;t<e[0];t++){const o=(0,h.getShift)(n[0],t),a={x:i.x+o.x,y:i.y+o.y};for(let i=0;i<e[1];i++){const o=(0,h.getShift)(n[1],i),u={x:a.x+o.x,y:a.y+o.y};if(!this.isEmptyAt(u))return;s.push(u),0!==t&&t!==e[0]-1||0!==i&&i!==e[1]-1||r.push(u)}}const o=t.addBuilding(r);s.forEach((t=>{this.markAt(t,o)}))}addNode(t){const i=new r.Node(this.nodes.length,t);return this.nodes.push(i),i}closePath(t){const i=t.getCursor(),e=this.addNode(i);return t.setNodeEnd(e),this.markAt(i,e),e}forkPath(t){let i=(0,h.forkDirection)(t.direction).sort((()=>this.variability(.5)?1:-1));if(i=this.filterDirections(t,i),0===i.length||1===i.length&&i[0]===t.direction)return;const e=this.closePath(t);for(let t=0;t<i.length;t++)(t<2||this.variability(.5))&&e.addOutputPath(i[t]);this.markAt(e.position,e)}turnPath(t){let i=(0,h.turnDirection)(t.direction).sort((()=>this.variability(.5)?1:-1));if(i=this.filterDirections(t,i),0===i.length)return;const e=this.closePath(t);e.addOutputPath(i[0]),this.markAt(e.position,e)}splitPath(t,i){const e=this.addNode(i),n=e.addOutputPath(t.direction);this.markAt(i,e);const r=t.getNodeEnd();return r?n.setNodeEnd(r):n.setCursor(t.getCursor()),n.each((t=>{this.getAt(t)instanceof s.Path&&this.markAt(t,n)})),t.setNodeEnd(e),e}getCross(t,i=1){const e=t.getCursor();for(let n=1;n<=i;n++){const i=(0,h.getShift)(t.direction,n),s={x:e.x+i.x,y:e.y+i.y};if(!this.isEmptyAt(s))return{tile:this.getAt(s),position:s}}return null}filterDirections(t,i){return i.filter((i=>{const e=(0,h.getShift)(i),n=t.getCursor(),s={x:n.x+e.x,y:n.y+e.y};return this.isEmptyAt(s)}))}variability(t){if(!this.seed)return(0,h.randomChance)(t);const i=this.seed[this.gauge%this.seed.length];return this.gauge++,i/1e3>=1-t}}},465:function(t,i,e){var n=this&&this.__createBinding||(Object.create?function(t,i,e,n){void 0===n&&(n=e);var s=Object.getOwnPropertyDescriptor(i,e);s&&!("get"in s?!i.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return i[e]}}),Object.defineProperty(t,n,s)}:function(t,i,e,n){void 0===n&&(n=e),t[n]=i[e]}),s=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||n(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),s(e(863),i),s(e(895),i),s(e(792),i),s(e(82),i),s(e(309),i)},792:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Node=void 0;const n=e(82),s=e(309);i.Node=class{constructor(t,i){this.outputPaths=[],this.inputPaths=[],this.id=t,this.position=i}addOutputPath(t){const i=new n.Path(this,t);return this.outputPaths.push(i),i}getOutputPaths(){return this.outputPaths}addInputPath(t){const i=t.getNodeEnd();i&&i.removeInputPath(t),this.inputPaths.push(t)}removeInputPath(t){const i=this.inputPaths.indexOf(t);-1!==i&&this.inputPaths.splice(i,1)}getInputPaths(){return this.inputPaths}getAllPaths(){return this.outputPaths.concat(this.inputPaths)}getType(){const t=this.outputPaths.length+this.inputPaths.length;return 2===t?s.NodeType.TURN:1===t?s.NodeType.END:s.NodeType.CROSS}}},82:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Path=void 0;const n=e(679),s=e(895);i.Path=class{constructor(t,i){this.buildings=[],this.nodeEnd=null,this.direction=i,this.nodeBeg=t,this.cursor=t.position}getBuildings(){return this.buildings}getPositions(){var t,i;return{beg:this.nodeBeg.position,end:null!==(i=null===(t=this.nodeEnd)||void 0===t?void 0:t.position)&&void 0!==i?i:this.cursor}}isCompleted(){return Boolean(this.nodeEnd)}getNextCursor(){const t=(0,n.getShift)(this.direction);return{x:this.cursor.x+t.x,y:this.cursor.y+t.y}}getCursor(){return this.cursor}setCursor(t){this.cursor=t}getNodeBeg(){return this.nodeBeg}getNodeEnd(){return this.nodeEnd}setNodeEnd(t){t.addInputPath(this),this.nodeEnd=t,this.cursor=t.position}addBuilding(t){const i=new s.Building(t);return this.buildings.push(i),i}getLength(){return Math.hypot(this.nodeBeg.position.x-this.cursor.x,this.nodeBeg.position.y-this.cursor.y)}each(t){const i=(0,n.getShift)(this.direction),e=this.getLength(),s=Object.assign({},this.nodeBeg.position);for(let n=0;n<e;n++)t(s),s.x+=i.x,s.y+=i.y}}},309:(t,i)=>{var e,n;Object.defineProperty(i,"__esModule",{value:!0}),i.NodeType=i.CityGenerationMode=void 0,function(t){t.RUNTIME="RUNTIME",t.SEED="SEED"}(e||(i.CityGenerationMode=e={})),function(t){t.TURN="TURN",t.CROSS="CROSS",t.END="END"}(n||(i.NodeType=n={}))},679:(t,i)=>{function e(t){return t*(Math.PI/180)}function n(t){return[(t+90)%360,(t-90)%360]}Object.defineProperty(i,"__esModule",{value:!0}),i.between=i.getShift=i.forkDirection=i.turnDirection=i.degToRad=i.generateSeed=i.randomRange=i.randomItem=i.randomChance=void 0,i.randomChance=function(t){return Math.random()>1-t},i.randomItem=function(t){return t[Math.floor(Math.random()*t.length)]},i.randomRange=function(t,i){return Math.floor(t+Math.random()*(i-t+1))},i.generateSeed=function(t=32){const i=[];for(let e=0;e<t;e++)i.push(Math.round(1e3*Math.random()));return i},i.degToRad=e,i.turnDirection=n,i.forkDirection=function(t){return[t].concat(n(t))},i.getShift=function(t,i=1){return{x:Math.round(Math.cos(e(t)))*i,y:Math.round(Math.sin(e(t)))*i}},i.between=function(t,i){return t>=i[0]&&t<=i[1]}}},i={},e=function e(n){var s=i[n];if(void 0!==s)return s.exports;var r=i[n]={exports:{}};return t[n].call(r.exports,r,r.exports,e),r.exports}(465);module.exports=e})();